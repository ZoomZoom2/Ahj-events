(()=>{"use strict";var e={p:""};class t{constructor(e=4){this.boardSize=e,this.container=null,this.boardEl=null,this.cells=[]}bindToDOM(e){if(!(e instanceof HTMLElement))throw new Error('Контейнер не является элементом "HTMLElement"');this.container=e}drawUi(){this.checkBinding(),this.container.innerHTML='\n      <div class="board-container">\n        <div class="controls">\n          <div class="counter hit-counter">Попаданий:\n            <div class="number hit-number">0</div>\n          </div>\n          <div class="counter miss-counter">Промахов:\n            <div class="number miss-number">0</div>\n          </div>\n        </div>\n        <div data-id="board" class="board"></div>\n      </div>\n    ',this.container.style.userSelect="none",this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.setAttribute("style",`grid-template-columns: repeat(${this.boardSize}, 1fr)`);for(let e=0;e<this.boardSize**2;e+=1){const e=document.createElement("div");e.classList.add("cell","map-tile"),this.boardEl.append(e)}this.cells=Array.from(this.boardEl.children),this.hitEl=document.querySelector(".hit-number"),this.missEl=document.querySelector(".miss-number")}getHitNumber(){return this.hitEl.innerText}setHitNumber(e){this.hitEl.innerText=e}getMissNumber(){return this.missEl.innerText}setMissNumber(e){this.missEl.innerHTML=e}static showMessage(e){alert(e)}deselectAll(){for(const e of this.cells)e.innerHTML=""}setCursor(e){this.boardEl.style.cursor=e}checkBinding(){if(null===this.container)throw new Error("Игровой процесс не привязан к DOM")}}const s=e.p+"assets/goblin2dbd01ce16c0fa83cb67.png",i={auto:"auto",hammer:`url(${e.p+"assets/hammer92_113d43e1424250396fce72f.png"}) 50 50, pointer`};class r{constructor(e){this.gamePlay=e,this.timerId=null}init(){this.gamePlay.drawUi(),this.startRandom(),this.gamePlay.cells.forEach((e=>{e.addEventListener("mousedown",(t=>{t.preventDefault();const s=e.querySelector("img");s&&(this.gamePlay.setHitNumber(Number.parseInt(this.gamePlay.getHitNumber(),10)+1),this.gamePlay.setCursor(i.hammer),s.remove(),setTimeout((()=>this.gamePlay.setCursor(i.auto)),200))}))}))}startRandom(){const e=document.createElement("img");let t;e.src=s,this.timerId=setInterval((()=>{for(const e of this.gamePlay.cells){const t=e.querySelector("img");t&&(t.remove(),this.gamePlay.setMissNumber(Number.parseInt(this.gamePlay.getMissNumber(),10)+1))}if(5===Number.parseInt(this.gamePlay.getMissNumber(),10))return void this.gameRestart();const s=r.getRandomInt(0,this.gamePlay.cells.length-1);s===t?s===this.gamePlay.cells.length-1?t-=1:t+=1:t=s,this.gamePlay.cells[t].append(e)}),1e3)}gameRestart(){this.gamePlay.setMissNumber(0),this.gamePlay.setHitNumber(0),this.gamePlay.deselectAll(),clearInterval(this.timerId),t.showMessage("Игра окончена!"),this.startRandom()}static getRandomInt(e,t){const s=Math.ceil(e),i=Math.floor(t);return Math.floor(Math.random()*(i-s)+s)}}const a=new t(4);a.bindToDOM(document.querySelector("#game-container"));new r(a).init()})();